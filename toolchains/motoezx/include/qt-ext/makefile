#############################################################################
# Makefile for building libqt-ext.so
# Generated by tmake at 16:31, 2010/03/24
#     Project: libqt-ext.so
#    Template: app
#############################################################################

####### Compiler, tools and options

CC	=	iwmmxt_le-gcc
CXX	=	iwmmxt_le-g++
CFLAGS	=	-pipe -Wall -W -O2 -mcpu=iwmmxt -mtune=iwmmxt -DNO_DEBUG
CXXFLAGS=	-pipe -DQWS -fpic -fno-exceptions -fno-rtti -Wall -W -O2 -mcpu=iwmmxt -mtune=iwmmxt -DNO_DEBUG
INCPATH	=	-I$(QTDIR)/include -I$(QTDIR)/include/qt -I$(QTDIR)/include/ezx -I../templates
LINK	=	iwmmxt_le-g++
LFLAGS	=	-shared
LIBS	=	$(SUBLIBS) -L$(QTDIR)/lib -lezxappsdk -lipp-jp -lezxopenwindow -lipp-miscGen -lezxappbase -lqte-mt -lezxjpeg -lezxpm
MOC	=	$(QTDIR)/bin/moc
UIC	=	$(QTDIR)/bin/uic

AR	=	iwmmxt_le-ar r
RANLIB	=	iwmmxt_le-ranlib

TAR	=	tar -cf
GZIP	=	gzip -9f

####### Files

HEADERS =	qcolordialog.h \
		qfiledialog.h \
		qfontdialog.h \
		tips.h \
		qlcdnumber.h \
		qbusybar.h \
		qlangcombo.h \
		qdial.h \
		fileview.h \
		qabstractlanglist.h \
		qlangmenu.h \
		qsettings.h \
		QProgressIndicator.h
SOURCES =	qcolordialog.cpp \
		qfiledialog.cpp \
		qfontdialog.cpp \
		qmessagebox.cpp \
		tips.cpp \
		qlcdnumber.cpp \
		qbusybar.cpp \
		qlangcombo.cpp \
		qinputdialog.cpp \
		qdial.cpp \
		fileview.cpp \
		qabstractlanglist.cpp \
		qlangmenu.cpp \
		qsettings.cpp \
		QProgressIndicator.cpp
OBJECTS =	objs/qcolordialog.o \
		objs/qfiledialog.o \
		objs/qfontdialog.o \
		objs/qmessagebox.o \
		objs/tips.o \
		objs/qlcdnumber.o \
		objs/qbusybar.o \
		objs/qlangcombo.o \
		objs/qinputdialog.o \
		objs/qdial.o \
		objs/fileview.o \
		objs/qabstractlanglist.o \
		objs/qlangmenu.o \
		objs/qsettings.o \
		objs/QProgressIndicator.o
INTERFACES =	
UICDECLS =	
UICIMPLS =	
SRCMOC	=	moc_qcolordialog.cpp \
		moc_qfiledialog.cpp \
		moc_qfontdialog.cpp \
		moc_qmessagebox.cpp \
		qcolordialog.moc \
		qfiledialog.moc \
		moc_tips.cpp \
		moc_qlcdnumber.cpp \
		moc_qbusybar.cpp \
		moc_qlangcombo.cpp \
		moc_qinputdialog.cpp \
		moc_qdial.cpp \
		moc_fileview.cpp \
		moc_qlangmenu.cpp \
		moc_QProgressIndicator.cpp
		
OBJMOC	=	objs/moc_qcolordialog.o \
		objs/moc_qfiledialog.o \
		objs/moc_qfontdialog.o \
		objs/moc_qmessagebox.o \
		objs/moc_tips.o \
		objs/moc_qlcdnumber.o \
		objs/moc_qbusybar.o \
		objs/moc_qlangcombo.o \
		objs/moc_qinputdialog.o \
		objs/moc_qdial.o \
		objs/moc_fileview.o \
		objs/moc_qlangmenu.o \
		objs/moc_QProgressIndicator.o
DIST	=	
TARGET	=	../lib/libqt-ext.so
TARGETA =	../lib/libqt-ext.a
INTERFACE_DECL_PATH = .
DEP = $(patsubst %.cpp,.%.d,$(filter %.cpp,$(SOURCES) $(SRCMOC)))
####### Implicit rules

.SUFFIXES: .cpp .c

#.cpp.o:
#	$(CXX) -c $(CXXFLAGS) $(INCPATH) -o $@ $<

.c.o:
	$(CC) -c $(CFLAGS) $(INCPATH) -o $@ $<

.%.d: %.cpp
	-$(CC) $(CXXFLAGS) -w -MM $^ >$@
	-sed -i 's/\(.*\)/objs\/\1/' $@

####### Build rules

#if not build *.moc first then can't find it. but moc_xxx.cpp no problem
all: moc $(TARGET) strip $(TARGETA)

.depend: $(SOURCES) $(SRCMOC)
	$(CC) $(CXXFLAGS) -w -MM $^ > $@

#include "xx.moc"无法加入到依赖关系?	
	
$(TARGET): $(UICDECLS) $(OBJECTS) $(OBJMOC) 
	$(LINK) $(LFLAGS) -o $(TARGET) $(OBJECTS) $(OBJMOC) $(LIBS)
	cp -auf $@ $(QTDIR)/lib/
	cp -auf $@ ./
	cp -auf $(HEADERS) $(QTDIR)/include/qt-ext/
	cp -auf $(SOURCES) $(QTDIR)/src/qt-ext/
	
$(TARGETA): $(UICDECLS) $(OBJECTS) $(OBJMOC)
	$(AR) $@ $^
	$(RANLIB) $@

moc: $(SRCMOC)
	 
dist:
	$(TAR) $(shell basename $(TARGET) .so).tar makefile $(SOURCES) $(HEADERS) $(INTERFACES) $(DIST)
	$(GZIP) $(shell basename $(TARGET) .so).tar
	mv $(shell basename $(TARGET) .so).tar.gz ..

clean:
	-rm -f $(OBJECTS) $(OBJMOC) $(SRCMOC) $(UICIMPLS) $(UICDECLS) $(TARGET) $(DEP)
	-rm -f `find ./ -name \*~` core libqt-ext.so

####### Sub-libraries


###### Combined headers


####### Compile
objs/%.o: %.cpp \
	%.moc \
	%.h \
	.%.d
	$(CXX) -c $(CXXFLAGS) $(INCPATH) -o $@ $<
	
objs/moc_%.o: moc_%.cpp .%.d
	$(CXX) -c $(CXXFLAGS) $(INCPATH) -o $@ $<	
	
-include $(DEP)




%.moc: %.cpp
	$(MOC) $< -o $@

moc_%.cpp: %.h
	$(MOC) $< -o $@

strip:
	cp $(TARGET) $(TARGET)_unstripped
	-arm-linux-strip $(TARGET)

